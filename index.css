/* ===========================================
   iOS Mobile Compatibility Fixes
   仅针对 iOS 移动端的兼容性修复
   =========================================== */

/* ============================================
   react-contenteditable 核心兼容样式（iOS 打包后必加）
   ============================================ */

/* 通用 editable-input 样式 - 解决「输入了但看不见」的核心问题 */
.editable-input {
    /* 强制文字渲染 */
    -webkit-text-fill-color: currentColor !important;
    opacity: 1 !important;
    visibility: visible !important;
    
    /* 确保可交互+渲染区域 */
    user-select: text !important;
    -webkit-user-select: text !important;
    pointer-events: auto !important;
    min-height: 44px !important;
    font-size: 16px !important;
    line-height: 1.75 !important;
    
    /* 保留换行 */
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    
    /* 兜底：确保渲染层级 */
    position: relative !important;
    z-index: 1 !important;
    display: block !important;
    width: 100% !important;
    padding: 12px !important;
    outline: none !important;
    
    /* 防止 iOS 自动调整 */
    -webkit-text-size-adjust: 100% !important;
    text-size-adjust: 100% !important;
    caret-color: auto !important;
}

/* 深色模式 */
.editable-input-dark {
    color: #e4e4e7 !important;
    -webkit-text-fill-color: #e4e4e7 !important;
}

/* 浅色模式 */
.editable-input-light {
    color: #18181b !important;
    -webkit-text-fill-color: #18181b !important;
}

/* 父容器样式：禁止任何可能阻断渲染的属性 */
.editable-wrapper {
    overflow: visible !important;
    height: auto !important;
    transform: none !important;
    -webkit-transform: none !important;
}

/* ============================================
   ContentEditable 核心样式 - 防止打包压缩影响
   ============================================ */

[contenteditable="true"] {
    font-size: 16px !important;
    line-height: 1.75 !important;
    padding: 12px !important;
    caret-color: auto !important;
    -webkit-text-size-adjust: 100% !important;
    text-size-adjust: 100% !important;
    -webkit-user-select: text !important;
    user-select: text !important;
}

/* ============================================
   iOS 专用修复 - 使用 @supports 检测
   ============================================ */

@supports (-webkit-touch-callout: none) {
    [contenteditable="true"],
    .editable-input {
        -webkit-tap-highlight-color: transparent;
        -webkit-user-select: text;
        user-select: text;
        touch-action: manipulation;
    }
    
    textarea,
    input[type="text"],
    input[type="search"],
    input[type="email"],
    input[type="url"] {
        font-size: 16px !important;
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
    }
    
    button,
    [role="button"],
    [data-interactive="true"] {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
    }
    
    .node-scroll,
    .node-scroll-dark {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
    }
    
    [contenteditable="true"] .chip,
    .editable-input .chip {
        -webkit-user-select: none;
        user-select: none;
        pointer-events: none;
        display: inline-flex !important;
    }
}

/* ============================================
   iOS Selection 修复 - 防止选区跳动
   ============================================ */

@media (hover: none) and (pointer: coarse) {
    [contenteditable="true"]::selection,
    .editable-input::selection {
        background-color: rgba(0, 150, 255, 0.3);
    }
    
    [contenteditable="true"]::-webkit-selection,
    .editable-input::-webkit-selection {
        background-color: rgba(0, 150, 255, 0.3);
    }
}

/* ============================================
   防止 iOS 上的双击缩放
   ============================================ */

@media (hover: none) {
    .canvas-container {
        touch-action: none;
    }
}

/* ============================================
   Chip 样式修复 - 确保在 iOS 上正确渲染
   ============================================ */

.chip {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    vertical-align: middle !important;
    transform: translateY(-1px) !important;
    -webkit-user-modify: read-only !important;
}

/* ============================================
   零宽字符处理 - 用于光标定位
   ============================================ */

[contenteditable="true"],
.editable-input {
    word-break: break-word;
    overflow-wrap: break-word;
}


/* ============================================
   iOS 按钮触摸事件修复 - 解决 build 后按钮不生效
   ============================================ */

/* 确保所有按钮在 iOS 上可点击 */
button,
[role="button"],
[data-interactive="true"] {
    /* 确保触摸事件可以穿透 */
    pointer-events: auto !important;
    /* iOS 触摸优化 */
    touch-action: manipulation !important;
    -webkit-tap-highlight-color: transparent !important;
    /* 确保元素可见且可交互 */
    cursor: pointer !important;
}

/* iOS Safari 特定修复 */
@supports (-webkit-touch-callout: none) {
    /* 修复 iOS 上 button 元素的触摸问题 */
    button {
        -webkit-appearance: none !important;
        appearance: none !important;
    }
    
    /* 确保 pointer-events-auto 类生效 */
    .pointer-events-auto {
        pointer-events: auto !important;
    }
    
    /* 修复 backdrop-blur 可能导致的触摸穿透问题 */
    .backdrop-blur-md,
    .backdrop-blur-sm,
    .backdrop-blur-xl {
        -webkit-backdrop-filter: blur(12px);
        backdrop-filter: blur(12px);
        /* 确保触摸事件正常 */
        pointer-events: auto;
    }
    
    /* 修复 fixed 定位元素的触摸问题 */
    .fixed {
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
    }
    
    /* 确保模态框关闭按钮可点击 */
    [class*="z-[100]"] button,
    [class*="z-[200]"] button {
        pointer-events: auto !important;
        touch-action: manipulation !important;
        position: relative !important;
        z-index: 1 !important;
    }
}

/* 移动端触摸区域优化 */
@media (hover: none) and (pointer: coarse) {
    /* 增大触摸目标 */
    button,
    [role="button"],
    [data-interactive="true"] {
        min-width: 44px;
        min-height: 44px;
    }
    
    /* 小按钮使用 padding 扩大触摸区域 */
    button.p-1,
    button.p-2 {
        position: relative;
    }
    
    button.p-1::before,
    button.p-2::before {
        content: '';
        position: absolute;
        top: -8px;
        right: -8px;
        bottom: -8px;
        left: -8px;
    }
}