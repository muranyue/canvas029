/* ===========================================
   Desktop & Mobile Compatibility Styles
   桌面端和移动端兼容性样式
   =========================================== */

/* ============================================
   全局拖动防选择样式
   ============================================ */

/* 防止拖动节点时触发浏览器选择模式 */
[data-drag-handle="true"] {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
}

[data-drag-handle="true"] img,
[data-drag-handle="true"] video {
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
    pointer-events: none;
}

/* 画布拖动时禁用全局选择 */
.cursor-grabbing,
.cursor-grabbing * {
    -webkit-user-select: none !important;
    -moz-user-select: none !important;
    -ms-user-select: none !important;
    user-select: none !important;
}

/* ============================================
   桌面端样式 - 使用030项目的标准布局
   ============================================ */

@media (min-width: 768px) {
    /* 桌面端 editable-input 样式 */
    .editable-input {
        font-size: 12px;
        line-height: 1.75rem; /* leading-7 */
        padding: 12px;
        color: inherit;
        -webkit-text-fill-color: inherit;
    }
    
    /* 桌面端深色模式 */
    .editable-input-dark {
        color: #a1a1aa; /* text-zinc-200 的实际值 */
        -webkit-text-fill-color: #a1a1aa;
    }
    
    /* 桌面端浅色模式 */
    .editable-input-light {
        color: #18181b;
        -webkit-text-fill-color: #18181b;
    }
    
    /* 桌面端父容器 */
    .editable-wrapper {
        overflow: hidden;
    }
    
    .editable-wrapper.dark {
        color: #a1a1aa;
    }
    
    .editable-wrapper.light {
        color: #18181b;
    }
    
    /* 桌面端 contenteditable */
    [contenteditable="true"] {
        font-size: 12px;
        line-height: 1.75rem;
        padding: 12px;
    }
}

/* ============================================
   移动端样式 - iOS 兼容性修复（保持不变）
   ============================================ */

@media (max-width: 767px) {
    /* 通用 editable-input 样式 - 解决「输入了但看不见」的核心问题 */
    .editable-input {
        /* iOS 真机文字颜色修复 - 强制显式颜色而非 currentColor */
        color: inherit !important;
        -webkit-text-fill-color: inherit !important;
        opacity: 1 !important;
        visibility: visible !important;
        
        /* 确保可交互+渲染区域 */
        user-select: text !important;
        -webkit-user-select: text !important;
        pointer-events: auto !important;
        font-size: 16px !important;
        line-height: 1.75 !important;
        
        /* 保留换行 */
        white-space: pre-wrap !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        
        /* 兜底：确保渲染层级 */
        position: relative !important;
        z-index: 1 !important;
        display: block !important;
        width: 100% !important;
        padding: 12px !important;
        outline: none !important;
        
        /* 防止 iOS 自动调整 */
        -webkit-text-size-adjust: 100% !important;
        text-size-adjust: 100% !important;
        caret-color: auto !important;
        
        /* 关键：允许键盘弹起 */
        touch-action: auto !important;
    }

    /* 深色模式 - iOS 真机显式颜色 */
    .editable-input-dark {
        color: #e4e4e7 !important;
        -webkit-text-fill-color: #e4e4e7 !important;
        background-color: transparent !important;
    }

    /* 浅色模式 - iOS 真机显式颜色 */
    .editable-input-light {
        color: #18181b !important;
        -webkit-text-fill-color: #18181b !important;
        background-color: transparent !important;
    }

    /* 父容器样式 - iOS 真机文字颜色继承修复 */
    .editable-wrapper {
        overflow: visible !important;
        height: auto !important;
        color: inherit !important;
    }

    /* 深色模式父容器 */
    .editable-wrapper.dark {
        color: #e4e4e7 !important;
    }

    /* 浅色模式父容器 */
    .editable-wrapper.light {
        color: #18181b !important;
    }

    /* ContentEditable 核心样式 - 防止打包压缩影响 */
    [contenteditable="true"] {
        font-size: 16px !important;
        line-height: 1.75 !important;
        padding: 12px !important;
        caret-color: auto !important;
        -webkit-text-size-adjust: 100% !important;
        text-size-adjust: 100% !important;
        -webkit-user-select: text !important;
        user-select: text !important;
        /* 关键：允许键盘弹起 */
        touch-action: auto !important;
        /* iOS 真机文字颜色显式设置 */
        color: inherit !important;
        -webkit-text-fill-color: inherit !important;
    }
}

/* ============================================
   iOS 专用修复 - 使用 @supports 检测
   ============================================ */

@supports (-webkit-touch-callout: none) {
    [contenteditable="true"],
    .editable-input {
        -webkit-tap-highlight-color: transparent;
        -webkit-user-select: text;
        user-select: text;
        /* iOS 真机文字颜色强制修复 */
        color: inherit !important;
        -webkit-text-fill-color: inherit !important;
    }
    
    /* 深色模式 iOS 真机修复 */
    [contenteditable="true"].editable-input-dark,
    .editable-input.editable-input-dark {
        color: #e4e4e7 !important;
        -webkit-text-fill-color: #e4e4e7 !important;
    }
    
    /* 浅色模式 iOS 真机修复 */
    [contenteditable="true"].editable-input-light,
    .editable-input.editable-input-light {
        color: #18181b !important;
        -webkit-text-fill-color: #18181b !important;
    }
    
    textarea,
    input[type="text"],
    input[type="search"],
    input[type="email"],
    input[type="url"] {
        font-size: 16px !important;
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
    }
    
    .node-scroll,
    .node-scroll-dark {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
    }
    
    [contenteditable="true"] .chip,
    .editable-input .chip {
        -webkit-user-select: none;
        user-select: none;
        pointer-events: none;
        display: inline-flex !important;
    }
}

/* ============================================
   iOS Selection 修复 - 防止选区跳动
   ============================================ */

@media (hover: none) and (pointer: coarse) {
    [contenteditable="true"]::selection,
    .editable-input::selection {
        background-color: rgba(0, 150, 255, 0.3);
    }
}

/* ============================================
   Chip 样式修复 - 确保在 iOS 上正确渲染
   ============================================ */

.chip {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    vertical-align: middle !important;
    transform: translateY(-1px) !important;
    -webkit-user-modify: read-only !important;
}

/* ============================================
   iOS 按钮触摸事件修复 - 仅针对特定按钮
   ============================================ */

@supports (-webkit-touch-callout: none) {
    /* 确保 pointer-events-auto 类生效 */
    .pointer-events-auto {
        pointer-events: auto !important;
    }
    
    /* 确保模态框关闭按钮可点击 */
    [class*="z-[100]"] button,
    [class*="z-[200]"] button {
        pointer-events: auto !important;
    }
}